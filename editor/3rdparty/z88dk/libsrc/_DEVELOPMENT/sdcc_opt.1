	.module %0
=
; Processed by Z88DK
;--------------------------------------------------------

;;
;; asz180 directives
;;

%"[ \t]*"1.hd64
=


%"[ \t]*"1.r3k
=


;;
;; global labels
;;

%"[ \t]*"1%0::
=
%1%0:

;;
;; labels
;;

%"[ \t]*"1%"[0-9]+"0$:%2
=
%1__sdcc_local_%0:%2

%"[ \t]*"1%0$:%2
=
%1%0:%2

%1,%"[ \t]*"2%"[0-9]+"0$
=
%1,%2__sdcc_local_%0

%1,%"[ \t]*"2%"[0-9]+"0$%"[ \t]*"7%"(\+|-)"8%9
=
%1,%2__sdcc_local_%0%7%8%9

%"[ \t]*"1%"(DJNZ|djnz)"3%"[ \t]*"2%"[0-9]+"0$
=
%1%3%2__sdcc_local_%0

%"[ \t]*"1%"(DJNZ|djnz)"3%"[ \t]*"2%"[0-9]+"0$%"[ \t]*"7%"(\+|-)"8%9
=
%1%3%2__sdcc_local_%0%7%8%9

%"[ \t]*"1%"[ \tA-Za-z_]+"0%"[0-9]+"2$
=
%1%0%2

%"[ \t]*"1%"[ \tA-Za-z_]+"0%"[0-9]+"2$%"[ \t]*"7%"(\+|-)"8%9
=
%1%0%2%7%8%9

%1,%"[ \t]*"2%0$%9
=
%1,%2%0%9

%1,%"[ \t]*"2%0$%"[ \t]*"7%"(\+|-)"8%9
=
%1,%2%0%7%8%9

%"[ \t]*"1%"(DJNZ|djnz)"3%"[ \t]*"2%0$%"[ \t]*"7%"(\+|-)"8%9
=
%1%3%2%0%7%8%9

%"[ \tA-Za-z_]+"0%1$
=
%0%1

%"[ \tA-Za-z_]+"0%1$%"[ \t]*"7%"(\+|-)"8%9
=
%0%1%7%8%9

;; must be last

%"[^$;\"]*"0$%1
=
%0%1

;;
;; sections
;;

%"[ \t]*"0.%"(AREA|area)"9%"[ \t]+"1_XSEG
=
%0SECTION%1IGNORE

%"[ \t]*"0.%"(AREA|area)"9%"[ \t]+"1_STACK
=
%0SECTION%1IGNORE

%"[ \t]*"0.%"(AREA|area)"9%"[ \t]+"1_CODE
=
;%0SECTION%1code_compiler

%"[ \t]*"0.%"(AREA|area)"9%"[ \t]+"1_DATA
=
;%0SECTION%1bss_compiler

%"[ \t]*"0.%"(AREA|area)"9%"[ \t]+"1_RSEG (ABS)
=
%0SECTION%1IGNORE

%"[ \t]*"0.%"(AREA|area)"9%"[ \t]+"1_GSINIT
=
;%0SECTION%1code_crt_init

%"[ \t]*"0.%"(AREA|area)"9%"[ \t]+"1_GSFINAL
=
;%0SECTION%1code_crt_exit

%"[ \t]*"0.%"(AREA|area)"9%"[ \t]+"1_HOME
=
%0SECTION%1IGNORE

%"[ \t]*"0.%"(AREA|area)"9%"[ \t]+"1_CABS (ABS)
=
%0SECTION%1IGNORE

%"[ \t]*"0.%"(AREA|area)"9%"[ \t]+"1_DABS (ABS)
=
%0SECTION%1IGNORE

%"[ \t]*"0.%"(AREA|area)"9%"[ \t]+"1_INITIALIZER
=
;%0SECTION%1data_compiler

	.%"(AREA|area)"9 _INITIALIZED
=
	
/*
	
; .area _INITIALIZED removed by z88dk
	

/*
=
%activate
;--------------------------------------------------------
; absolute external ram data
;--------------------------------------------------------
=
%once
	
*/
	
;--------------------------------------------------------
; absolute external ram data
;--------------------------------------------------------

%"[ \t]*"1.%"(AREA|area)"9%"[ \t]*"2_%0
=
%1SECTION%2%0

%"[ \t]*"1.%"(AREA|area)"9%"[ \t]*"2%0
=
%1SECTION%2%0

;;
;; assembler directives
;;

%"[ \t]*"1.%"(ASCII|ascii)"9%"[ \t]+"2%0
=
%1DEFM%2%0

%"[ \t]*"1.%"(ASCIZ|asciz)"9%"[ \t]+"2%0
=
%1DEFM%2%0,0

%"[ \t]*"1.%"(DS|ds)"9%"[ \t]+"2%0
=
%1DEFS%2%0

%"[ \t]*"1.%"(DB|db)"9%"[ \t]+"2%0
=
%1DEFB%2%0

%"[ \t]*"1.%"(BYTE|byte)"9%"[ \t]+"2%0
=
%1DEFB%2%0

%"[ \t]*"1.%"(DW|dw)"9%"[ \t]+"2%0
=
%1DEFW%2%0

%"[ \t]*"1.%"(GLOBL|globl)"9%"[ \t]+"2%0
=

%"[ \t]*"1.%"(ORG|org)"9%"[ \t]+"2%0
=
%1ORG%2%0

;;
;; label = PC
;;

%"[ \t]*"1%"[A-Za-z0-9_]"0%"[ \t]*"2=%"[ \t]*"3.
=
%1%0:

;;
;; define constants
;;

%"[ \t]*"2%"[A-Za-z0-9_]+"0%"[ \t]*"3=%"[ \t]*"4%1
=
%2defc %0%3=%4%1

;;
;; asxxx syntax for LSB / MSB
;;

%1#<(%0)
=
%1#((%0) & 0xFF)

%1#>(%0)
=
%1#((%0) / 256)

%1(#<(%0))
=
%1(#((%0) & 0xFF))

%1(#>(%0))
=
%1(#((%0) / 256))

%1<((%0))
=
%1#((%0) & 0xFF)

%1>((%0))
=
%1#((%0) / 256)

%1(<((%0)))
=
%1(#((%0) & 0xFF))

%1(>((%0)))
=
%1(#((%0) / 256))

%1#<%0
=
%1#((%0) & 0xFF)

%1#>%0
=
%1#((%0) / 256)

;;
;; zilog syntax for index registers
;;

%0,%"[ \t]*"2%"[ \t+0-9-]+"1(%"(IX|ix)"9)
=
%0,(%9+%1)

%"[ \tA-Za-z]+"0%"[ \t+0-9-]+"1(%"(IX|ix)"9)
=
%0(%9+%1)

%"[ \tA-Za-z]+"0%"[ \t+0-9-]+"1(%"(IX|ix)"9)%"[ \t]*"2,%"[ \t]*"3%4
=
%0(%9+%1),%4

%0,%"[ \t]*"2%"[ \t+0-9-]+"1(%"(IY|iy)"9)
=
%0,(%9+%1)

%"[ \tA-Za-z]+"0%"[ \t+0-9-]+"1(%"(IY|iy)"9)
=
%0(%9+%1)

%"[ \tA-Za-z]+"0%"[ \t+0-9-]+"1(%"(IY|iy)"9)%"[ \t]*"2,%"[ \t]*"3%4
=
%0(%9+%1),%4

;;
;; _INITIALIZER variables made into actual variable names
;;

__xinit_%0
=
%0

;;
;; asxxx immediate operator #
;;

%"[^\"'#;]*"0#%1
=
%0+%1

;;
;; beautify
;;

%"[ \t]*"5SECTION%"[ \t]+"0%1
%"[ \t]*"4SECTION%"[ \t]+"3%2
=
%4SECTION%3%2

%"[^\"';+]*"0+-%1
=
%0-%1

%"[^\"';+]*"0++%1
=
%0+%1

%"[^\"';,]*"0,%"[ ]*"+%"[^(]"1%2
=
%0,%1%2

%"[^\"';(]*"0(+%1
=
%0(%1

%"[^+-]+"0%"[+-]+"1%"[0-9][0-9+-]*"2%"[ \t]+"3)
=
%0%1%2)

%"[^+-]+"0%"[+-]+"1%"[0-9][0-9+-]*"2%"[ \t]+"3)%4
=
%0%1%2)%4

;;
;; Rabbit instructions
;; ld      hl, 0 (hl)
;; ld      0 (sp), hl

	ld	%1 (sp), %2
=
	ld	(sp + %1),%2

	ld	hl, %1 (%2)
=
	ld	hl,(%2 + %1)

	ld	iy, %1 (%2)
=
	ld	iy,(%2 + %1)

	ld	ix, %1 (%2)
=
	ld	ix,(%2 + %1)
